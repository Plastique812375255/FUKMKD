# res文件格式分析报告

## 文件基本结构

经过分析，`sys/sound_1_vbc2_en/res`文件是一种打包文件格式，具有以下结构：

1. **文件头（4字节）**：存储文件条目数量，采用大端序（Big-Endian）格式
   - 本例中值为 `0x00000023`，表示有35个条目

2. **条目表（每个条目44字节）**：
   - 从偏移量4开始
   - 每条目44字节，共35个条目
   - 条目表总大小：35 * 44 = 1540字节

3. **数据区**：
   - 从偏移量1544（0x608）开始
   - 存储实际的WAV音频文件内容

## 44字节条目结构分析

通过分析与WAV文件起始位置、大小的对照，每个44字节条目的结构如下：

1. **字节0-27**：文件名（ASCII字符串，空字节填充）
   - 例如："batt_alarmb.wav"

2. **字节28-31**（4字节，Value1）：
   - 在所有分析的例子中为0
   - 可能为标志位或预留字段

3. **字节32-35**（4字节，Value2）：
   - 文件大小（以字节为单位）
   - 例如：batt_alarmb.wav的大小为16492字节

4. **字节36-39**（4字节，Value3）：
   - 累积偏移量（相对于数据区起始位置）
   - 示例：第二个文件batt_alarml.wav的累积偏移量为16492，正好是第一个文件的大小
   - 该值表示文件在数据区的起始位置相对于数据区开始的偏移量

5. **字节40-43**（4字节，Value4）：
   - 可能是校验和或其他标识符
   - 无明显规律

## 检索文件的方法

要从res文件中检索特定的WAV文件，可以按照以下步骤进行：

1. 读取文件头的条目数量（前4个字节，大端序）
2. 遍历条目表，查找所需的文件名
3. 找到对应条目后，提取其中的文件大小（Value2）和累积偏移量（Value3）
4. 计算文件在res中的实际起始位置：
   - 实际起始位置 = 数据区起始位置 + 累积偏移量
   - 即：实际起始位置 = 4 + (条目数 * 44) + 累积偏移量
5. 从计算得出的起始位置开始，读取指定大小的数据

## 异常情况分析

在分析中我们发现：

1. 部分条目的计算起点与实际起点有差异：
   - 如nav_unlock.wav、screen_lock.wav等
   - 这可能表明实际数据布局与条目表中的记录有不一致，可能是由于文件被修改或者特殊处理

2. beep_1.au和beep_2.au文件未找到匹配的RIFF头：
   - 这可能是由于这些文件使用了不同的格式（.au而非.wav）
   - .au文件不以RIFF魔数开头，因此未被本次分析识别

## 结论

res文件是一种带有索引的资源包格式，其中：
- 文件头标识包含的总条目数
- 条目表包含每个文件的名称、大小和偏移量信息
- 数据区按照条目表中的顺序和偏移量存储实际文件内容

通过理解这种文件格式，可以方便地提取、修改或替换其中的资源文件。 